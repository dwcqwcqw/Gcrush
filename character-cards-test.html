<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§’è‰²å¡æµ‹è¯• - Gcrush</title>
    <link rel="stylesheet" href="candy-combined.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            min-height: 100vh;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .test-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .test-header p {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 10px 5px;
        }
        
        .status-loading {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            color: #ffc107;
        }
        
        .status-success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid rgba(40, 167, 69, 0.5);
            color: #28a745;
        }
        
        .status-error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.5);
            color: #dc3545;
        }
        
        .debug-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            color: white;
        }
        
        .debug-info h3 {
            margin-top: 0;
            color: var(--accent-purple);
        }
        
        .debug-info pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.9rem;
        }
        
        .refresh-btn {
            background: var(--accent-purple);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .refresh-btn:hover {
            background: var(--accent-pink);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ­ è§’è‰²å¡æ˜¾ç¤ºæµ‹è¯•</h1>
            <p>æµ‹è¯•ä»æ•°æ®åº“åŠ¨æ€åŠ è½½è§’è‰²å¡çš„åŠŸèƒ½</p>
            <div id="statusIndicators">
                <span class="status-indicator status-loading" id="loadingStatus">
                    â³ æ­£åœ¨åŠ è½½...
                </span>
            </div>
            <button class="refresh-btn" onclick="refreshCharacters()">
                ğŸ”„ é‡æ–°åŠ è½½è§’è‰²å¡
            </button>
        </div>
        
        <div class="debug-info" id="debugInfo">
            <h3>ğŸ“Š è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debugContent">
                <p>ç­‰å¾…æ•°æ®åŠ è½½...</p>
            </div>
        </div>
        
        <!-- è§’è‰²å¡å®¹å™¨ -->
        <div class="character-grid" id="characterGrid">
            <!-- è§’è‰²å¡å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="candy-combined.js"></script>
    <script src="character-data-loader.js"></script>
    
    <script>
        // æµ‹è¯•è„šæœ¬
        let testStartTime = Date.now();
        
        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatus(type, message) {
            const statusContainer = document.getElementById('statusIndicators');
            const statusClass = `status-${type}`;
            const icon = type === 'loading' ? 'â³' : type === 'success' ? 'âœ…' : 'âŒ';
            
            statusContainer.innerHTML = `
                <span class="status-indicator ${statusClass}">
                    ${icon} ${message}
                </span>
            `;
        }
        
        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo(info) {
            const debugContent = document.getElementById('debugContent');
            const loadTime = Date.now() - testStartTime;
            
            debugContent.innerHTML = `
                <p><strong>åŠ è½½æ—¶é—´:</strong> ${loadTime}ms</p>
                <p><strong>æ•°æ®æ¥æº:</strong> ${info.dataSource || 'æœªçŸ¥'}</p>
                <p><strong>è§’è‰²æ•°é‡:</strong> ${info.characterCount || 0}</p>
                <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${info.error || 'æ— '}</p>
                <p><strong>æœ€åæ›´æ–°:</strong> ${new Date().toLocaleString()}</p>
                ${info.characters ? `
                    <details>
                        <summary>è§’è‰²æ•°æ®è¯¦æƒ…</summary>
                        <pre>${JSON.stringify(info.characters, null, 2)}</pre>
                    </details>
                ` : ''}
            `;
        }
        
        // åˆ·æ–°è§’è‰²å¡
        function refreshCharacters() {
            testStartTime = Date.now();
            updateStatus('loading', 'æ­£åœ¨é‡æ–°åŠ è½½è§’è‰²å¡...');
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            const characterGrid = document.getElementById('characterGrid');
            characterGrid.innerHTML = '<div class="loading-message">æ­£åœ¨åŠ è½½è§’è‰²æ•°æ®...</div>';
            
            // é‡æ–°åŠ è½½
            if (window.characterLoader) {
                window.characterLoader.renderCharacterCards();
            } else {
                updateStatus('error', 'è§’è‰²åŠ è½½å™¨æœªåˆå§‹åŒ–');
                updateDebugInfo({
                    error: 'è§’è‰²åŠ è½½å™¨æœªåˆå§‹åŒ–',
                    dataSource: 'æ— ',
                    characterCount: 0
                });
            }
        }
        
        // ç›‘å¬è§’è‰²åŠ è½½å™¨çš„çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('loading', 'åˆå§‹åŒ–è§’è‰²åŠ è½½å™¨...');
            
            // ç­‰å¾…è§’è‰²åŠ è½½å™¨åˆå§‹åŒ–
            setTimeout(() => {
                if (window.characterLoader) {
                    // ç›‘å¬åŠ è½½å®Œæˆ
                    const originalRenderMethod = window.characterLoader.renderCharacterCards;
                    window.characterLoader.renderCharacterCards = async function() {
                        try {
                            await originalRenderMethod.call(this);
                            
                            // æ›´æ–°çŠ¶æ€
                            const characters = this.getAllCharacters();
                            updateStatus('success', `æˆåŠŸåŠ è½½ ${characters.length} ä¸ªè§’è‰²`);
                            updateDebugInfo({
                                dataSource: this.hasError ? 'é»˜è®¤æ•°æ®ï¼ˆæ•°æ®åº“è¿æ¥å¤±è´¥ï¼‰' : 'æ•°æ®åº“',
                                characterCount: characters.length,
                                error: this.hasError ? this.errorMessage : null,
                                characters: characters.map(c => ({
                                    name: c.name,
                                    age: c.age,
                                    tags: [c.tag1, c.tag2, c.tag3].filter(Boolean)
                                }))
                            });
                            
                        } catch (error) {
                            updateStatus('error', `åŠ è½½å¤±è´¥: ${error.message}`);
                            updateDebugInfo({
                                error: error.message,
                                dataSource: 'å¤±è´¥',
                                characterCount: 0
                            });
                        }
                    };
                } else {
                    updateStatus('error', 'è§’è‰²åŠ è½½å™¨æœªæ‰¾åˆ°');
                    updateDebugInfo({
                        error: 'è§’è‰²åŠ è½½å™¨æœªæ‰¾åˆ°',
                        dataSource: 'æ— ',
                        characterCount: 0
                    });
                }
            }, 1000);
        });
        
        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(event) {
            console.error('é¡µé¢é”™è¯¯:', event.error);
            updateStatus('error', `é¡µé¢é”™è¯¯: ${event.error.message}`);
        });
        
        // ç›‘å¬è§’è‰²å¡ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(event) {
            if (event.target.closest('.character-card')) {
                const characterCard = event.target.closest('.character-card');
                const characterName = characterCard.dataset.character;
                
                console.log('ç‚¹å‡»äº†è§’è‰²å¡:', characterName);
                
                // æ˜¾ç¤ºè§’è‰²è¯¦æƒ…
                const character = window.characterLoader?.findCharacterByName(characterName);
                if (character) {
                    alert(`è§’è‰²è¯¦æƒ…:\n\nå§“å: ${character.name}\nå¹´é¾„: ${character.age}\næ ‡ç­¾: ${[character.tag1, character.tag2, character.tag3].filter(Boolean).join(', ')}\n\næè¿°: ${character.description}`);
                }
            }
        });
    </script>
</body>
</html> 